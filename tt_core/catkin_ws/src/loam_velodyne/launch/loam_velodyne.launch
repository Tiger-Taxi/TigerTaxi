<launch>

    <arg name="rviz" default="false"/>
    <arg name="scanPeriod" default="0.1"/>
    <arg name="imuHistorySize" default="200"/>
    <arg name="featureRegions" default="6"/>
    <arg name="curvatureRegion" default="5"/>
    <arg name="maxCornerSharp" default="2"/>
    <arg name="maxSurfaceFlat" default="4"/>
    <arg name="surfaceCurvatureThreshold" default="0.1"/>
    <arg name="lessFlatFilterSize" default="0.2"/>
    <arg name="ioRatio" default="2"/>
    <arg name="maxIterationsOdom" default="25"/>
    <arg name="deltaTAbortOdom" default="0.1"/>
    <arg name="deltaRAbortOdom" default="0.1"/>
    <arg name="maxIterationsMapping" default="10"/>
    <arg name="deltaTAbortMapping" default="0.05"/>
    <arg name="deltaRAbortMapping" default="0.05"/>

    <remap from="/noimu" to="/imu/data"/> <!-- Remap the IMU to nothing. It's not in the correct coordinate system. -->

    <node pkg="loam_velodyne" type="multiScanRegistration" name="multiScanRegistration" output="screen">
        <remap from="/multi_scan_points" to="/velodyne_points"/>

        <param name="lidar" value="VLP-16"/> <!-- options: VLP-16  HDL-32  HDL-64E -->
        <param name="scanPeriod" value="$(arg scanPeriod)"/>
        <param name="imuHistorySize" value="$(arg imuHistorySize)"/>
        <param name="featureRegions" value="$(arg featureRegions)"/>
        <param name="curvatureRegion" value="$(arg curvatureRegion)"/>
        <param name="maxCornerSharp" value="$(arg maxCornerSharp)"/>
        <param name="maxSurfaceFlat" value="$(arg maxSurfaceFlat)"/>
        <param name="surfaceCurvatureThreshold" value="$(arg surfaceCurvatureThreshold)"/>
        <param name="lessFlatFilterSize" value="$(arg lessFlatFilterSize)"/>
        <!--<param name="minVerticalAngle" value="$(arg minVerticalAngle)" />-->
        <!--<param name="maxVerticalAngle" value="$(arg maxVerticalAngle)" />-->
        <!--<param name="nScanRings" value="$(arg nScanRings)" />-->
    </node>

    <node pkg="loam_velodyne" type="laserOdometry" name="laserOdometry" output="screen" respawn="true">
        <param name="scanPeriod" value="$(arg scanPeriod)"/>
        <param name="ioRatio" value="$(arg ioRatio)"/>
        <param name="maxIterations" value="$(arg maxIterationsOdom)"/>
        <param name="deltaTAbort" value="$(arg deltaTAbortOdom)"/>
        <param name="deltaRAbort" value="$(arg deltaRAbortOdom)"/>
    </node>

    <node pkg="loam_velodyne" type="laserMapping" name="laserMapping" output="screen">
        <param name="scanPeriod" value="$(arg scanPeriod)"/>
        <param name="maxIterations" value="$(arg maxIterationsMapping)"/>
        <param name="deltaTAbort" value="$(arg deltaTAbortMapping)"/>
        <param name="deltaRAbort" value="$(arg deltaRAbortMapping)"/>
        <!--<param name="cornerFilterSize" value="$(arg cornerFilterSize)" />-->
        <!--<param name="surfaceFilterSize" value="$(arg surfaceFilterSize)" />-->
        <!--<param name="mapFilterSize" value="$(arg mapFilterSize)" />-->

        <!--<remap from="laser_odom_to_init" to="ekf/loam_converted_odom_gps_corrected"/>-->
    </node>

    <node pkg="loam_velodyne" type="transformMaintenance" name="transformMaintenance" output="screen">
        <!--<remap from="laser_odom_to_init" to="ekf/loam_converted_odom_gps_corrected"/>-->
    </node>

    <group if="$(arg rviz)">
        <node launch-prefix="nice" pkg="rviz" type="rviz" name="rviz"
              args="-d $(find loam_velodyne)/rviz_cfg/loam_velodyne.rviz"/>
    </group>

</launch>
